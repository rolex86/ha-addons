name: "UniFi SSH Presence (MQTT)"
slug: "unifi_ssh_presence"
description: "Presence bez UniFi Controlleru: SSH polling UniFi AP a MQTT autodiscovery device_tracker"
version: "0.3.1"
url: "https://github.com/rolex86/ha-addons/tree/master/presence-ssh-mqtt"
arch:
  - aarch64
  - amd64
  - armv7
  - armhf
  - i386

init: false
startup: services
boot: auto
homeassistant_api: false
hassio_api: false
host_network: false
ingress: false

options:
  mqtt:
    host: "core-mosquitto"
    port: 1883
    username: ""
    password: ""
    discovery_prefix: "homeassistant"
    base_topic: "unifi_presence"
    client_id: "unifi_ssh_presence"

  poll_interval_sec: 90
  away_after_misses: 3

  ssh:
    username: "unifiap"
    password: ""
    port: 22
    connect_timeout_sec: 8
    cmd_timeout_sec: 12
    known_hosts_strict: false

  # Seznam UniFi AP (SSH). Nech schválně prázdné – vyplníš v konfiguraci add-onu v HA.
  # aps:
  #   - name: "ap_1"
  #     host: "192.168.1.10"
  aps: []

  # Learn mode: sbírá "neznámé" (ne-whitelist) klienty do /data/seen_devices.json
  # a do logu zapisuje jen při změně (nový MAC / poprvé IPv4).
  learn_mode: true
  learn_max_entries: 50

  # Whitelist zařízení, která se budou publikovat jako device_tracker
  # devices:
  #   - mac: "aa:bb:cc:dd:ee:ff"
  #     name: "Phone"
  #     allow_randomized: false
  devices: []

schema:
  mqtt:
    host: str
    port: int
    username: str?
    password: password?
    discovery_prefix: str
    base_topic: str
    client_id: str

  poll_interval_sec: int
  away_after_misses: int

  ssh:
    username: str
    password: password
    port: int
    connect_timeout_sec: int
    cmd_timeout_sec: int
    known_hosts_strict: bool

  aps:
    - name: str
      host: str

  learn_mode: bool
  learn_max_entries: int

  devices:
    - mac: str
      name: str
      allow_randomized: bool?

ports: {}
log_level: info
