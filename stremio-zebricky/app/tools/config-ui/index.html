<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Config UI – Vlastní žebříčky</title>
    <style>
      :root {
        --bg: #0b0f14;
        --panel: #111823;
        --panel2: #0f1620;
        --text: #e9eef7;
        --muted: #9aa7b7;
        --border: rgba(255, 255, 255, 0.1);
        --border2: rgba(255, 255, 255, 0.08);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 16px;
        --radius2: 12px;
        --gap: 14px;
        --blue: #2d8cff;
        --green: #22c55e;
        --red: #ef4444;
        --yellow: #f59e0b;
        --purple: #a78bfa;
        --mono:
          ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        --sans:
          ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial,
          "Noto Sans", "Liberation Sans", sans-serif;

        /* ===========================
           FORM READABILITY IMPROVEMENTS
           =========================== */
        --card-bg: rgba(255, 255, 255, 0.035); /* sjednocenější pozadí karet */
        --field-bg: rgba(255, 255, 255, 0.06); /* input surface: viditelnější */
        --field-bg-hover: rgba(255, 255, 255, 0.075);
        --field-bg-focus: rgba(255, 255, 255, 0.09);

        --field-border: rgba(255, 255, 255, 0.16);
        --field-border-hover: rgba(255, 255, 255, 0.22);
        --field-border-focus: rgba(45, 140, 255, 0.55);

        --ring: 0 0 0 3px rgba(45, 140, 255, 0.22);
        --placeholder: rgba(233, 238, 247, 0.55);
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: var(--sans);
        color: var(--text);
        background-color: var(--bg);

        background-image:
          radial-gradient(
            1100px 800px at 20% 0%,
            rgba(45, 140, 255, 0.18) 0%,
            rgba(45, 140, 255, 0.1) 28%,
            rgba(45, 140, 255, 0.05) 50%,
            rgba(45, 140, 255, 0) 78%
          ),
          radial-gradient(
            1100px 800px at 80% 10%,
            rgba(34, 197, 94, 0.14) 0%,
            rgba(34, 197, 94, 0.08) 30%,
            rgba(34, 197, 94, 0.04) 52%,
            rgba(34, 197, 94, 0) 80%
          );

        /* TADY je ta klíčová část */
        background-repeat: no-repeat, no-repeat;
        background-position:
          20% 0%,
          80% 10%;
        background-attachment: fixed;
      }

      /* iOS: zabraň “text autosize” randomu a zoomu při fokusu */
      html {
        -webkit-text-size-adjust: 100%;
      }

      .wrap {
        max-width: 1400px;
        margin: 0 auto;
        padding: 18px 18px 28px;
      }

      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 14px 16px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.06),
          rgba(255, 255, 255, 0.02)
        );
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        position: sticky;
        top: 12px;
        z-index: 10;
        backdrop-filter: blur(6px);
        overflow: hidden;
      }
      .topbar::before {
        content: "";
        position: absolute;
        inset: 0 0 auto 0;
        height: 2px;
        background: linear-gradient(
          90deg,
          rgba(45, 140, 255, 0.6),
          rgba(34, 197, 94, 0.5),
          rgba(167, 139, 250, 0.5)
        );
        opacity: 0.9;
      }

      .brand {
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 260px;
      }
      .brand .h {
        font-weight: 800;
        letter-spacing: 0.02em;
      }
      .brand .s {
        font-size: 12px;
        color: var(--muted);
      }

      .actions {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .grid {
        margin-top: 16px;
        display: grid;
        grid-template-columns: 380px 1fr;
        gap: var(--gap);
        align-items: start;
      }
      @media (max-width: 1100px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .brand {
          min-width: unset;
        }
        .actions {
          justify-content: flex-start;
        }
      }

      /* Card: lehce sjednocenější, aby inputy víc vystoupily */
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.05),
          rgba(255, 255, 255, 0.03)
        );
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 16px;
        position: relative;
        overflow: hidden;
      }
      .card h3 {
        margin: 0 0 12px 0;
        font-size: 13px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #cfe0ff;
      }
      .sub {
        margin: 0 0 12px 0;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.45;
      }

      /* Accent cards */
      .cardAccent::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
      }
      .cardAccent.blue::before {
        background: rgba(45, 140, 255, 0.65);
      }

      .cardAccent.purple::before {
        background: rgba(167, 139, 250, 0.6);
      }

      label.small {
        display: block;
        margin: 10px 0 6px;
        font-size: 12px;
        color: var(--muted);
      }

      /* IMPORTANT: match inputs even if type is missing (SmartPicks) */
      input:not([type="checkbox"]):not([type="range"]),
      select,
      textarea {
        width: 100%;
        padding: 11px 12px;
        border-radius: 12px;
        border: 1px solid var(--field-border);
        outline: none;
        background: var(--field-bg);
        color: var(--text);
        box-shadow:
          inset 0 1px 0 rgba(255, 255, 255, 0.06),
          0 1px 0 rgba(0, 0, 0, 0.25);
        transition:
          background 0.15s ease,
          border-color 0.15s ease,
          box-shadow 0.15s ease,
          transform 0.15s ease;
      }
      textarea {
        min-height: 90px;
        resize: vertical;
      }

      /* placeholder – viditelný, ale odlišený */
      input::placeholder,
      textarea::placeholder {
        color: var(--placeholder);
      }

      /* hover – lehce zvednout čitelnost a “klikatelnost” */
      input:not([type="checkbox"]):not([type="range"]):hover,
      select:hover,
      textarea:hover {
        background: var(--field-bg-hover);
        border-color: var(--field-border-hover);
      }

      /* focus – jasný ring + ještě o chlup světlejší plocha */
      input:focus,
      select:focus,
      textarea:focus {
        background: var(--field-bg-focus);
        border-color: var(--field-border-focus);
        box-shadow: var(--ring);
      }
      /* preferuj focus-visible (ať ring neskáče po klikání myší všude) */
      input:focus:not(:focus-visible),
      select:focus:not(:focus-visible),
      textarea:focus:not(:focus-visible) {
        box-shadow: none;
      }
      input:focus-visible,
      select:focus-visible,
      textarea:focus-visible {
        box-shadow: var(--ring);
      }

      /* disabled – jasné, že nejde editovat */
      input:disabled,
      select:disabled,
      textarea:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* select šipka – ať nepůsobí “mrtvě” */
      select {
        appearance: none;
        background-image:
          linear-gradient(
            45deg,
            transparent 50%,
            rgba(233, 238, 247, 0.65) 50%
          ),
          linear-gradient(
            135deg,
            rgba(233, 238, 247, 0.65) 50%,
            transparent 50%
          );
        background-position:
          calc(100% - 18px) 50%,
          calc(100% - 12px) 50%;
        background-size:
          6px 6px,
          6px 6px;
        background-repeat: no-repeat;
        padding-right: 34px;
      }

      /* Chrome autofill – ať nezelená / nerozbije dark UI */
      input:-webkit-autofill,
      textarea:-webkit-autofill,
      select:-webkit-autofill {
        -webkit-text-fill-color: var(--text);
        transition: background-color 9999s ease-out 0s;
        box-shadow:
          0 0 0px 1000px rgba(255, 255, 255, 0.06) inset,
          inset 0 1px 0 rgba(255, 255, 255, 0.06);
        border: 1px solid var(--field-border);
      }

      .row2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      @media (max-width: 700px) {
        .row2 {
          grid-template-columns: 1fr;
        }
      }

      .btn {
        border: 1px solid var(--border2);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 700;
        transition:
          0.15s transform,
          0.15s opacity,
          0.15s background;
        user-select: none;
      }
      .btn:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.09);
      }
      .btn:active {
        transform: translateY(0px);
        opacity: 0.9;
      }

      .btn.primary {
        background: rgba(45, 140, 255, 0.18);
        border-color: rgba(45, 140, 255, 0.35);
      }
      .btn.primary:hover {
        background: rgba(45, 140, 255, 0.25);
      }
      .btn.danger {
        background: rgba(239, 68, 68, 0.15);
        border-color: rgba(239, 68, 68, 0.35);
      }
      .btn.danger:hover {
        background: rgba(239, 68, 68, 0.22);
      }
      .btn.success {
        background: rgba(34, 197, 94, 0.14);
        border-color: rgba(34, 197, 94, 0.32);
      }
      .btn.success:hover {
        background: rgba(34, 197, 94, 0.2);
      }
      .btn.small {
        padding: 7px 10px;
        font-size: 12px;
        border-radius: 10px;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border2);
        background: rgba(0, 0, 0, 0.18);
        color: var(--muted);
        font-size: 12px;
        white-space: nowrap;
      }
      .pill strong {
        color: var(--text);
      }

      .mono {
        font-family: var(--mono);
      }
      .muted {
        color: var(--muted);
      }

      .divider {
        height: 1px;
        background: var(--border2);
        margin: 16px 0;
      }

      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        overflow: hidden;
        border-radius: 14px;
        border: 1px solid var(--border2);
      }
      th,
      td {
        text-align: left;
        padding: 12px 12px;
        font-size: 13px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        vertical-align: middle;
      }
      th {
        font-size: 12px;
        color: var(--muted);
        background: rgba(255, 255, 255, 0.04);
        position: sticky;
        top: 0;
        z-index: 1;
      }
      tr:last-child td {
        border-bottom: none;
      }

      .tableBtn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 12px;
        border: 1px solid var(--border2);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        font-weight: 800;
        cursor: pointer;
        transition:
          0.15s transform,
          0.15s background,
          0.15s opacity;
        user-select: none;
      }
      .tableBtn:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.1);
      }
      .tableBtn:active {
        transform: translateY(0px);
        opacity: 0.92;
      }

      /* Help / hints (collapsible) */
      details.help {
        margin: 6px 0 0;
        border: 1px dashed rgba(255, 255, 255, 0.14);
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.14);
        overflow: hidden;
      }
      details.help > summary {
        list-style: none;
        cursor: pointer;
        padding: 8px 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        user-select: none;
        color: var(--muted);
        font-size: 12px;
      }
      details.help > summary::-webkit-details-marker {
        display: none;
      }
      details.help > summary .k {
        font-family: var(--mono);
        color: #d9e6ff;
        font-size: 11.5px;
      }
      details.help[open] > summary {
        color: var(--text);
        background: rgba(255, 255, 255, 0.03);
      }
      .helpBody {
        padding: 10px 10px 10px;
        color: var(--muted);
        font-size: 12px;
        line-height: 1.45;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
      }
      .helpBody code {
        font-family: var(--mono);
        color: #d9e6ff;
      }
      .helpBody ul {
        margin: 8px 0 0 18px;
        padding: 0;
      }

      /* Year sliders */
      .yearGrid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        align-items: start;
      }
      @media (max-width: 900px) {
        .yearGrid {
          grid-template-columns: 1fr;
        }
      }
      .yearBox {
        border: 1px solid var(--border2);
        border-radius: 14px;
        padding: 14px;
        background: rgba(0, 0, 0, 0.16);
      }
      .yearBox .head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 8px;
        color: var(--muted);
        font-size: 12px;
      }
      input[type="range"] {
        width: 100%;
        margin: 8px 0 0;
        accent-color: var(--blue);
      }
      .hint {
        margin-top: 8px;
        color: var(--muted);
        font-size: 12px;
        line-height: 1.4;
      }

      /* Genres (List editor) */
      .genrePanel {
        border: 1px solid var(--border2);
        border-radius: 14px;
        padding: 14px;
        background: rgba(0, 0, 0, 0.16);
      }
      .genreTop {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 10px;
      }
      .genreTop input {
        flex: 1 1 220px;
      }

      #genreBox {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
        gap: 8px 10px;
        margin-top: 8px;
        max-height: 260px;
        overflow: auto;
        padding-right: 6px;
      }

      .genreItem {
        display: flex;
        align-items: center;
        gap: 10px;
        border: 1px solid rgba(255, 255, 255, 0.07);
        background: rgba(255, 255, 255, 0.03);
        border-radius: 999px;
        padding: 7px 10px;
        cursor: pointer;
        user-select: none;
      }
      .genreItem:hover {
        background: rgba(255, 255, 255, 0.05);
      }
      .genreItem input {
        width: 16px;
        height: 16px;
        margin: 0;
        accent-color: var(--blue);
        flex: 0 0 auto;
      }
      .genreItem code {
        font-family: var(--mono);
        font-size: 12px;
        color: #d9e6ff;
        background: transparent;
      }

      .card.noShift {
        padding-left: 16px !important;
        padding-right: 16px !important;
        margin-left: 0 !important;
      }

      /* accordion */
      .section {
        border: 1px solid var(--border2);
        border-radius: 14px;
        background: rgba(0, 0, 0, 0.16); /* upraveno pro čitelnost */
        overflow: hidden;
        margin-bottom: 14px;
        position: relative;
      }
      .section::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
      }
      .section.sectionUpdate::before {
        background: rgba(245, 158, 11, 0.859);
      }
      .section.sectionLists::before {
        background: rgba(34, 197, 94, 0.6);
      }
      .section.sectionSmart::before {
        background: rgba(167, 139, 250, 0.6);
      }

      .section.sectionSmart::before {
        background: rgba(167, 139, 250, 0.6);
      }

      .section > summary {
        list-style: none;
        cursor: pointer;
        padding: 12px 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.05),
          rgba(255, 255, 255, 0.02)
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        user-select: none;
      }
      .section.sectionUpdate > summary {
        background: linear-gradient(
          180deg,
          rgba(245, 158, 11, 0.12),
          rgba(255, 255, 255, 0.02)
        );
      }
      .section.sectionLists > summary {
        background: linear-gradient(
          180deg,
          rgba(34, 197, 94, 0.11),
          rgba(255, 255, 255, 0.02)
        );
      }
      .section.sectionSmart > summary {
        background: linear-gradient(
          180deg,
          rgba(167, 139, 250, 0.11),
          rgba(255, 255, 255, 0.02)
        );
      }

      .section > summary::-webkit-details-marker {
        display: none;
      }
      .sectionTitle {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .sectionTitle strong {
        letter-spacing: 0.06em;
        text-transform: uppercase;
        font-size: 12px;
        color: #cfe0ff;
      }
      .sectionTitle span {
        font-size: 12px;
        color: var(--muted);
      }
      .sectionChevron {
        font-size: 12px;
        color: var(--muted);
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border2);
        background: rgba(0, 0, 0, 0.18);
        white-space: nowrap;
      }
      details[open] > summary .sectionChevron {
        color: var(--text);
      }
      .sectionBody {
        padding: 14px;
      }

      /* SmartPicks styling */
      .row {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }
      .grid2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        align-items: start;
      }
      @media (max-width: 1000px) {
        .grid2 {
          grid-template-columns: 1fr;
        }
      }

      .box {
        border: 1px solid var(--border2);
        border-radius: 14px;
        background: rgba(0, 0, 0, 0.16);
        padding: 14px;
      }
      .boxHead {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 10px;
        color: var(--text);
        font-size: 13px;
      }
      .tableWrap {
        overflow: auto;
        border-radius: 12px;
      }
      table.tbl th,
      table.tbl td {
        padding: 10px 10px;
        font-size: 12.5px;
      }
      table.tbl th {
        font-size: 12px;
      }

      .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .lbl {
        font-size: 12px;
        color: var(--muted);
      }
      .chk {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text);
        font-size: 13px;
      }
      .chk input {
        width: 16px;
        height: 16px;
        accent-color: var(--blue);
      }

      .hr {
        height: 1px;
        background: rgba(255, 255, 255, 0.08);
        margin: 12px 0;
      }

      .subHead {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 8px;
      }
      .subHead strong {
        font-size: 13px;
      }

      .chipBox {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 8px 10px;
        padding-right: 6px;
        max-height: 200px;
        overflow: auto;
      }
      .chip {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.07);
        background: rgba(255, 255, 255, 0.03);
        cursor: pointer;
        user-select: none;
      }
      .chip:hover {
        background: rgba(255, 255, 255, 0.05);
      }
      .chip input {
        width: 16px;
        height: 16px;
        margin: 0;
        accent-color: var(--blue);
        flex: 0 0 auto;
      }

      .checkList {
        max-height: 260px;
        overflow: auto;
        padding-right: 6px;
        display: grid;
        gap: 8px;
      }
      .chkRow {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        padding: 8px 10px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.07);
        background: rgba(255, 255, 255, 0.03);
        cursor: pointer;
        user-select: none;
      }
      .chkRow:hover {
        background: rgba(255, 255, 255, 0.05);
      }
      .chkRow input {
        width: 16px;
        height: 16px;
        margin-top: 2px;
        accent-color: var(--blue);
        flex: 0 0 auto;
      }
      .chkRow span {
        font-size: 12.5px;
        line-height: 1.35;
      }

      .genreBox {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
        gap: 8px 10px;
        max-height: 260px;
        overflow: auto;
        padding-right: 6px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 12px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.1);
      }
      .genreTri {
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
        text-align: left;
        border-radius: 999px;
        padding: 8px 10px;
        border: 1px solid rgba(255, 255, 255, 0.07);
        background: rgba(255, 255, 255, 0.03);
        color: var(--text);
        cursor: pointer;
        user-select: none;
      }
      .genreTri:hover {
        background: rgba(255, 255, 255, 0.05);
      }
      .genreTri code {
        font-family: var(--mono);
        font-size: 12px;
        color: #d9e6ff;
      }
      .genreTri[data-state="include"] {
        border-color: rgba(34, 197, 94, 0.35);
        background: rgba(34, 197, 94, 0.1);
      }
      .genreTri[data-state="exclude"] {
        border-color: rgba(239, 68, 68, 0.35);
        background: rgba(239, 68, 68, 0.1);
      }

      .compactBottom {
        margin-top: 12px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        flex-wrap: wrap;
      }

      /* Update log box */
      .logBox {
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.18);
        padding: 12px;
        max-height: 340px;
        overflow: auto;
        font-family: var(--mono);
        font-size: 12px;
        line-height: 1.45;
        white-space: pre-wrap;
      }

      /* ===========================
         Mobile UX improvements
         =========================== */

      @media (max-width: 700px) {
        .topbar {
          position: static;
        }

        /* trochu víc místa po stranách */
        .wrap {
          padding: 12px 12px 22px;
        }

        /* topbar na mobilu: méně "sticky" stresu + lepší rozložení */
        .topbar {
          top: 8px;
          padding: 12px;
          gap: 10px;
          flex-direction: column;
          align-items: stretch;
        }
        .brand {
          gap: 6px;
        }

        /* akce: tlačítka hezky do gridu, ať nejsou malá */
        .actions {
          width: 100%;
          justify-content: flex-start;
          gap: 8px;
          display: grid;
          grid-template-columns: 1fr 1fr;
        }

        /* token input přes celou šířku, ať se dobře píše */
        #token {
          max-width: none !important;
          grid-column: 1 / -1;
        }

        /* status pills taky přes celou šířku (ne miniaturní vpravo) */
        #status,
        #updatePill {
          grid-column: 1 / -1;
        }

        /* tlačítka ať jsou "fat-finger friendly" */
        .btn,
        .tableBtn {
          padding: 12px 12px;
          font-size: 14px;
          border-radius: 14px;
        }
        .btn.small {
          padding: 12px 12px;
          font-size: 14px;
          border-radius: 14px;
        }

        /* inputs/textareas: větší font = žádný iOS auto-zoom + lepší editace */
        input:not([type="checkbox"]):not([type="range"]),
        select,
        textarea {
          padding: 12px 12px;
          border-radius: 14px;
          font-size: 16px; /* klíčové pro iOS */
          line-height: 1.25;
        }

        /* labely a pomocné texty trochu větší */
        label.small,
        .lbl,
        .sub,
        .hint,
        details.help > summary,
        .helpBody,
        .sectionTitle span {
          font-size: 13px;
        }
        .sectionTitle strong {
          font-size: 13px;
        }

        /* checkboxy větší "tap area" */
        .chk {
          font-size: 14px;
        }
        .chk input,
        .genreItem input,
        .chip input,
        .chkRow input {
          width: 20px;
          height: 20px;
        }

        /* sekce tělo trochu víc dýchá */
        .sectionBody {
          padding: 14px 12px;
        }

        /* tabulky: na mobilu radši horizontálně scrollovat a zvětšit text */
        .tableWrap,
        .tableWrap table,
        .tableWrap thead,
        .tableWrap tbody,
        .tableWrap tr,
        .tableWrap td,
        .tableWrap th {
          font-size: 14px;
        }
        table.tbl th,
        table.tbl td,
        table th,
        table td {
          padding: 12px 10px;
          font-size: 14px;
        }
      }
      /* ===========================
   Sticky topbar: jen desktop
   (vypne sticky na mobilu včetně landscape)
   =========================== */

      /* default: není sticky */
      .topbar {
        position: static;
        top: auto;
      }

      /* sticky až od větší šířky */
      @media (min-width: 900px) {
        .topbar {
          position: sticky;
          top: 12px;
        }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <div class="h">Config UI – Vlastní žebříčky</div>
          <div class="s">
            Upravuje <span class="mono">config/lists.trakt.json</span> a
            <span class="mono">config/secrets.json</span>
          </div>
          <details class="help" style="margin-top: 10px">
            <summary>
              <span>Jak to celé používat</span>
              <span class="k">nápověda</span>
            </summary>
            <div class="helpBody">
              Doporučený postup:
              <ul>
                <li>
                  Vyplň <code>TRAKT Client ID</code> a
                  <code>Client Secret</code>.
                </li>
                <li>
                  Uprav <code>Defaults</code> a listy / SmartPicks vpravo.
                </li>
                <li>Klikni <strong>Uložit vše na disk</strong>.</li>
                <li>
                  Pak dej <strong>Spustit aktualizaci</strong> (vygeneruje listy
                  + SmartPicks + případně enrich).
                </li>
              </ul>
              Pokud je zapnutý <code>CONFIG_UI_TOKEN</code>, vyplň ho nahoře
              (jinak API vrátí 401).
            </div>
          </details>
        </div>

        <div class="actions">
          <span class="pill">Seznamů: <strong id="countPill">0</strong></span>

          <input
            id="token"
            type="password"
            placeholder="CONFIG_UI_TOKEN (pokud je zapnutý)"
            style="max-width: 320px"
          />

          <button class="btn small" id="btnLoad" type="button">
            Načíst z disku
          </button>
          <button class="btn success small" id="btnSaveAll" type="button">
            Uložit vše na disk
          </button>
          <button class="btn small" id="btnRunUpdate" type="button">
            Spustit aktualizaci
          </button>
          <button class="btn danger small" id="btnStopUpdate" type="button">
            Stop
          </button>
          <button class="btn small" id="btnRestartAddon" type="button">
            Restart add-on serveru
          </button>

          <span id="status" class="pill">Status: <strong>—</strong></span>
          <span id="updatePill" class="pill">Update: <strong>—</strong></span>

          <details class="help" style="width: 100%">
            <summary>
              <span>Co dělají tlačítka nahoře</span>
              <span class="k">nápověda</span>
            </summary>
            <div class="helpBody">
              <ul>
                <li>
                  <strong>Načíst z disku</strong>: načte aktuální
                  <code>/data/config/lists.trakt.json</code> +
                  <code>secrets.json</code> do UI.
                </li>
                <li>
                  <strong>Uložit vše na disk</strong>: zapíše změny z UI do
                  <code>/data/config/…</code>.
                </li>
                <li>
                  <strong>Spustit aktualizaci</strong>: spustí
                  <code>tools/update-lists.js</code> a streamuje logy (update +
                  enrich).
                </li>
                <li>
                  <strong>Stop</strong>: pošle SIGTERM běžícímu update procesu.
                </li>
                <li>
                  <strong>Restart add-on serveru</strong>: restartne hlavní
                  addon server (Stremio endpointy).
                </li>
              </ul>
            </div>
          </details>
        </div>
      </div>

      <div class="grid">
        <!-- LEFT -->
        <div class="card cardAccent blue">
          <details class="section sectionDefaults" open>
            <summary>
              <div class="sectionTitle">
                <strong>Defaults</strong>
                <span
                  >Výchozí hodnoty pro generování (lze přepsat per-list)</span
                >
              </div>
              <div class="sectionChevron">Rozbalit / sbalit</div>
            </summary>

            <div class="sectionBody">
              <p class="sub">
                Výchozí hodnoty pro generování (lze přepsat per-list).
              </p>

              <label class="small">candidatePages</label>
              <input id="d_candidatePages" type="number" min="1" step="1" />
              <details class="help">
                <summary>
                  <span>Co to ovlivňuje</span
                  ><span class="k">defaults.candidatePages</span>
                </summary>
                <div class="helpBody">
                  Kolik stránek kandidátů se stáhne z Traktu pro každý list.
                  Více stránek = více kandidátů, ale delší běh a víc API
                  requestů.
                </div>
              </details>

              <label class="small">pageLimit</label>
              <input id="d_pageLimit" type="number" min="1" step="1" />
              <details class="help">
                <summary>
                  <span>Co to ovlivňuje</span
                  ><span class="k">defaults.pageLimit</span>
                </summary>
                <div class="helpBody">
                  Kolik položek se bere z jedné stránky Traktu (typicky 100).
                  Nižší číslo = více stránek pro stejný počet kandidátů.
                </div>
              </details>

              <label class="small">finalSize</label>
              <input id="d_finalSize" type="number" min="1" step="1" />
              <details class="help">
                <summary>
                  <span>Co to ovlivňuje</span
                  ><span class="k">defaults.finalSize</span>
                </summary>
                <div class="helpBody">
                  Kolik položek se nakonec uloží do jednoho listu
                  (<code>/data/lists/&lt;id&gt;.json</code>). Vyšší = delší
                  enrich, větší soubory.
                </div>
              </details>

              <label class="small">sleepMs</label>
              <input id="d_sleepMs" type="number" min="0" step="10" />
              <details class="help">
                <summary>
                  <span>Co to ovlivňuje</span
                  ><span class="k">defaults.sleepMs</span>
                </summary>
                <div class="helpBody">
                  Pauza mezi requesty (Trakt/ČSFD/Cinemeta). Pomáhá proti rate
                  limitům. Doporučení: 80–200 ms.
                </div>
              </details>

              <label class="small">timeoutMs</label>
              <input id="d_timeoutMs" type="number" min="1000" step="500" />
              <details class="help">
                <summary>
                  <span>Co to ovlivňuje</span
                  ><span class="k">defaults.timeoutMs</span>
                </summary>
                <div class="helpBody">
                  Timeout pro HTTP requesty. Pokud padá síť / API je pomalé,
                  zvedni to.
                </div>
              </details>

              <label class="small">csfdCacheTtlDays</label>
              <input id="d_csfdTtl" type="number" min="1" step="1" />
              <details class="help">
                <summary>
                  <span>Co to ovlivňuje</span
                  ><span class="k">defaults.csfdCacheTtlDays</span>
                </summary>
                <div class="helpBody">
                  Jak dlouho se drží mapování a data z ČSFD v cache (aby se
                  zbytečně nehledalo znovu).
                </div>
              </details>

              <div class="divider"></div>

              <h3>dupRules</h3>
              <p class="sub">
                Aby se ti napříč řádky neopakovaly stejné filmy.
              </p>

              <label class="small">dupRules.hardBlockTop</label>
              <input id="d_hardTop" type="number" min="0" step="1" />
              <details class="help">
                <summary>
                  <span>Co to ovlivňuje</span
                  ><span class="k">dupRules.hardBlockTop</span>
                </summary>
                <div class="helpBody">
                  Prvních N pozic v listu neobsadí položka, která už byla
                  použita v jiném listu stejného typu. Když listy vycházejí moc
                  podobně, zvedni to.
                </div>
              </details>

              <label class="small">dupRules.penaltyPerHit</label>
              <input id="d_penalty" type="number" min="0" step="1" />
              <details class="help">
                <summary>
                  <span>Co to ovlivňuje</span
                  ><span class="k">dupRules.penaltyPerHit</span>
                </summary>
                <div class="helpBody">
                  Skóre penalizace za každé předchozí použití té samé položky.
                  Vyšší = víc diverzity.
                </div>
              </details>

              <div class="divider"></div>

              <h3>Trakt secrets</h3>
              <p class="sub">
                Používá se pro Trakt API. Ukládá se do
                <span class="mono">config/secrets.json</span>.
              </p>

              <label class="small">TRAKT Client ID</label>
              <input id="traktId" type="text" placeholder="client_id" />
              <details class="help">
                <summary>
                  <span>Kde to vzít</span
                  ><span class="k">secrets.trakt.client_id</span>
                </summary>
                <div class="helpBody">
                  V Trakt aplikaci (developer settings). Používá se pro veřejné
                  API requesty (genres, trending, …).
                </div>
              </details>

              <label class="small">TRAKT Client Secret</label>
              <input
                id="traktSecret"
                type="password"
                placeholder="client_secret"
              />
              <details class="help">
                <summary>
                  <span>Kde to vzít</span
                  ><span class="k">secrets.trakt.client_secret</span>
                </summary>
                <div class="helpBody">
                  Nutné pro device auth (pokud někde používáš token). Pro běžné
                  čtení veřejných endpointů často stačí Client ID, ale necháváme
                  i secret, aby se to nerozsypalo v jiných částech addonu.
                </div>
              </details>


              <label class="small">TMDB Access Token (volitelne)</label>
              <input
                id="tmdbToken"
                type="password"
                placeholder="tmdb.access_token"
              />
              <details class="help">
                <summary>
                  <span>Kde to vzit</span
                  ><span class="k">secrets.tmdb.access_token</span>
                </summary>
                <div class="helpBody">
                  V TMDB API nastaveni vytvor v4 Read Access Token. Pouziva se pro
                  TMDB sources (provider: <code>tmdb</code>).
                </div>
              </details>

              <label class="small">TMDB API key (volitelne)</label>
              <input
                id="tmdbApiKey"
                type="password"
                placeholder="tmdb.api_key"
              />
              <details class="help">
                <summary>
                  <span>Kde to vzit</span
                  ><span class="k">secrets.tmdb.api_key</span>
                </summary>
                <div class="helpBody">
                  Alternativa k access tokenu. Staci vyplnit bud access token nebo
                  api key.
                </div>
              </details>
              <div class="divider"></div>
              <p class="sub">
                <strong>Tip:</strong> pokud jsi v LAN, nastav
                <span class="mono">CONFIG_UI_TOKEN</span> (ochrana UI).
              </p>
            </div>
          </details>
        </div>

        <!-- RIGHT -->
        <div class="card cardAccent green noShift">
          <!-- UPDATE SECTION -->
          <details class="section sectionUpdate">
            <summary>
              <div class="sectionTitle">
                <strong>Aktualizace / enrich</strong>
                <span>Spustí update proces a streamuje logy</span>
              </div>
              <div class="sectionChevron">Rozbalit / sbalit</div>
            </summary>
            <div class="sectionBody">
              <details class="help">
                <summary>
                  <span>Co přesně se spustí</span
                  ><span class="k">tools/update-lists.js</span>
                </summary>
                <div class="helpBody">
                  Orchestrátor typicky:
                  <ul>
                    <li>
                      vygeneruje listy (Trakt + ČSFD) do
                      <code>/data/lists</code>
                    </li>
                    <li>vygeneruje SmartPicks do <code>/data/lists</code></li>
                    <li>
                      když se změnily base listy, spustí enrich
                      (poster/background/desc)
                    </li>
                  </ul>
                  Log stream je přes SSE (<code>/api/update-stream</code>).
                </div>
              </details>

              <div class="row" style="justify-content: space-between">
                <div class="pill">Běží: <strong id="updRunning">—</strong></div>
                <div class="pill">
                  Progress: <strong id="updProgress">—</strong>
                </div>
              </div>

              <div class="row" style="margin-top: 10px">
                <button class="btn small" id="btnClearUpdateLog" type="button">
                  Vyčistit log
                </button>
              </div>

              <div id="updateLog" class="logBox" style="margin-top: 10px"></div>
            </div>
          </details>

          <!-- LISTS SECTION -->
          <details class="section sectionLists" open>
            <summary>
              <div class="sectionTitle">
                <strong>Seznamy</strong>
                <span>Tabulka listů + editor listu</span>
              </div>
              <div class="sectionChevron">Rozbalit / sbalit</div>
            </summary>
            <div class="sectionBody">
              <details class="help">
                <summary>
                  <span>Jak fungují filtry (years/genres)</span
                  ><span class="k">lists[].filters</span>
                </summary>
                <div class="helpBody">
                  <ul>
                    <li>
                      <code>filters.years</code> =
                      <code>YYYY-YYYY</code> (range)
                    </li>
                    <li>
                      <code>filters.genres</code> = include (Trakt query +
                      lokální filtr)
                    </li>
                    <li>
                      <code>filters.genresExclude</code> = exclude (lokální
                      filtr)
                    </li>
                  </ul>
                  Exclude má přednost před include.
                </div>
              </details>

              <p class="sub">
                Klikni na <strong>Edit</strong> v řádku nebo vytvoř nový list
                dole.
              </p>

              <div style="overflow: auto; border-radius: 14px">
                <table>
                  <thead>
                    <tr>
                      <th style="width: 160px">id</th>
                      <th>name</th>
                      <th style="width: 90px">type</th>
                      <th style="width: 230px">source.path</th>
                      <th style="width: 120px">years</th>
                      <th>genres</th>
                      <th style="width: 110px"></th>
                    </tr>
                  </thead>
                  <tbody id="tblBody"></tbody>
                </table>
              </div>

              <div class="divider"></div>

              <h3>List editor</h3>

              <div class="row2">
                <div>
                  <label class="small">id (unikátní)</label>
                  <input id="f_id" type="text" placeholder="např. vhs_era" />
                  <details class="help">
                    <summary>
                      <span>Co to je</span><span class="k">lists[].id</span>
                    </summary>
                    <div class="helpBody">
                      Unikátní ID souboru: výstup bude
                      <code>/data/lists/&lt;id&gt;.json</code>. Používej jen
                      písmena/čísla/underscore.
                    </div>
                  </details>
                </div>
                <div>
                  <label class="small">name (zobrazí se ve Stremiu)</label>
                  <input
                    id="f_name"
                    type="text"
                    placeholder="např. VHS éra (1985–2000)"
                  />
                  <details class="help">
                    <summary>
                      <span>Co to je</span><span class="k">lists[].name</span>
                    </summary>
                    <div class="helpBody">
                      Čitelný název listu pro zobrazení ve Stremiu.
                    </div>
                  </details>
                </div>
              </div>

              <div class="row2" style="margin-top: 10px">
                <div>
                  <label class="small">type</label>
                  <select id="f_type">
                    <option value="movie">movie</option>
                    <option value="series">series</option>
                  </select>
                  <details class="help">
                    <summary>
                      <span>Co to ovlivňuje</span
                      ><span class="k">lists[].type</span>
                    </summary>
                    <div class="helpBody">
                      Určuje, jestli se bere <code>movie</code> nebo
                      <code>show</code> objekt z Traktu, a jaké enrichování se
                      použije.
                    </div>
                  </details>
                </div>
                <div>
                  <label class="small">source.path (Trakt/TMDB)</label>
                  <select id="f_source"></select>
                  <details class="help">
                    <summary>
                      <span>Co sem patří</span
                      ><span class="k">lists[].source.path</span>
                    </summary>
                    <div class="helpBody">
                      Endpoint zdroje, napr. <code>/movies/trending</code>,
                      <code>/movie/popular</code>, <code>/trending/movie/day</code>,
                      nebo <code>/shows/trending</code>. Udrzuj konzistenci s
                      <code>type</code>.
                    </div>
                  </details>
                </div>
              </div>

              <div id="f_sourcesPicker_wrap" style="margin-top: 12px">
                <div class="subHead" style="margin-bottom: 8px">
                  <strong>Zdroje</strong>
                  <span class="muted">Trakt + TMDB (per-list)</span>
                </div>

                <div class="muted" style="margin: 6px 0 8px">
                  <strong>Trakt zdroje:</strong>
                </div>
                <div id="f_src_trakt" class="chipBox"></div>

                <div class="muted" style="margin: 12px 0 8px">
                  <strong>TMDB zdroje:</strong>
                </div>
                <div id="f_src_tmdb" class="chipBox"></div>

                <div class="row" style="gap: 8px; margin-top: 10px">
                  <input
                    id="f_customSource"
                    type="text"
                    class="mono"
                    placeholder="vlastni /movies/... /shows/... /movie/... /tv/..."
                  />
                  <button id="btnListAddSource" class="btn small" type="button">
                    Pridat
                  </button>
                </div>

                <div class="muted" style="margin: 12px 0 8px">
                  <strong>Vybrane zdroje tohoto listu:</strong>
                </div>
                <div id="f_src_selected" class="checkList"></div>
              </div>

              <div style="margin-top: 12px">
                <label class="small">Roky (od–do)</label>
                <div class="yearGrid">
                  <div class="yearBox">
                    <div class="head">
                      <span>Od</span>
                      <input
                        id="yearMinNum"
                        type="number"
                        style="width: 110px"
                      />
                    </div>
                    <input id="yearMin" type="range" />
                  </div>

                  <div class="yearBox">
                    <div class="head">
                      <span>Do</span>
                      <input
                        id="yearMaxNum"
                        type="number"
                        style="width: 110px"
                      />
                    </div>
                    <input id="yearMax" type="range" />
                  </div>
                </div>

                <div class="hint">
                  Vybrané roky se uloží do
                  <span class="mono">filters.years</span> jako
                  <span class="mono">YYYY-YYYY</span>. Když necháš plný rozsah,
                  uloží se prázdný filter.
                </div>

                <details class="help">
                  <summary>
                    <span>Jak se to aplikuje</span
                    ><span class="k">filters.years</span>
                  </summary>
                  <div class="helpBody">
                    Roky se používají jako lokální filtr nad výsledky z Traktu.
                    Když kandidát nemá rok, většinou projde (aby to nebylo moc
                    přísné).
                  </div>
                </details>

                <input id="f_years" type="text" style="display: none" />
              </div>

              <div style="margin-top: 12px">
                <label class="small">Žánry (klikni + filtruj)</label>

                <div class="genrePanel">
                  <div class="genreTop">
                    <input
                      id="genreSearch"
                      type="text"
                      placeholder="hledej žánr… (např. thri)"
                    />
                    <input
                      id="genreCustom"
                      type="text"
                      placeholder="přidat vlastní žánr (slug)"
                      style="max-width: 260px"
                    />
                    <button class="btn small" id="btnAddGenre" type="button">
                      Přidat
                    </button>
                    <button class="btn small" id="btnClearGenres" type="button">
                      Vyčistit
                    </button>
                  </div>

                  <div id="genreBox"></div>

                  <div class="hint">
                    Klikáním přepínáš: none →
                    <span class="mono">include</span> →
                    <span class="mono">exclude</span>. Uloží se do
                    <span class="mono">filters.genres</span> (include) a
                    <span class="mono">filters.genresExclude</span> (exclude).
                  </div>

                  <details class="help">
                    <summary>
                      <span>Jak include/exclude funguje</span
                      ><span class="k"
                        >filters.genres / filters.genresExclude</span
                      >
                    </summary>
                    <div class="helpBody">
                      <ul>
                        <li>
                          <strong>include</strong>: kandidát musí mít alespoň
                          jeden z vybraných žánrů (pokud známe žánry).
                        </li>
                        <li>
                          <strong>exclude</strong>: kandidát nesmí mít žádný
                          zakázaný žánr (pokud známe žánry).
                        </li>
                      </ul>
                      Pokud kandidát žánry nemá (někdy Trakt), filtr se aplikuje
                      “soft” (nevyhazuje se jen proto, že chybí metadata).
                    </div>
                  </details>

                  <input id="f_genres" type="text" style="display: none" />
                </div>
              </div>

              <div id="csfdRow" style="margin-top: 14px">
                <h3>ČSFD filtry (jen pro movie)</h3>

                <div class="row2">
                  <div>
                    <label class="small">csfdRules.minRating</label>
                    <input
                      id="f_minRating"
                      type="number"
                      min="0"
                      max="100"
                      step="1"
                      placeholder="např. 70"
                    />
                    <details class="help">
                      <summary>
                        <span>Co to dělá</span
                        ><span class="k">csfdRules.minRating</span>
                      </summary>
                      <div class="helpBody">
                        Minimální % hodnocení na ČSFD pro zařazení do listu.
                      </div>
                    </details>
                  </div>
                  <div>
                    <label class="small">csfdRules.minCount</label>
                    <input
                      id="f_minCount"
                      type="number"
                      min="0"
                      step="1"
                      placeholder="např. 800"
                    />
                    <details class="help">
                      <summary>
                        <span>Co to dělá</span
                        ><span class="k">csfdRules.minCount</span>
                      </summary>
                      <div class="helpBody">
                        Minimální počet hlasů na ČSFD. Pomáhá proti “malým
                        vzorkům”.
                      </div>
                    </details>
                  </div>
                </div>

                <div class="row2" style="margin-top: 10px">
                  <div>
                    <label class="small">csfdRules.maxCount</label>
                    <input
                      id="f_maxCount"
                      type="number"
                      min="0"
                      step="1"
                      placeholder="např. 60000"
                    />
                    <details class="help">
                      <summary>
                        <span>Co to dělá</span
                        ><span class="k">csfdRules.maxCount</span>
                      </summary>
                      <div class="helpBody">
                        Maximální počet hlasů (když chceš omezit “mainstream” a
                        držet to víc niche).
                      </div>
                    </details>
                  </div>
                  <div></div>
                </div>
              </div>

              <div class="divider"></div>

              <h3>Per-list overrides (volitelné)</h3>
              <details class="help" style="margin-bottom: 10px">
                <summary>
                  <span>Jak overrides fungují</span
                  ><span class="k">lists[].*</span>
                </summary>
                <div class="helpBody">
                  Když necháš pole prázdné, použije se hodnota z
                  <code>defaults</code>. Když vyplníš, přepíše to jen pro tenhle
                  list.
                </div>
              </details>

              <div class="row2">
                <div>
                  <label class="small">candidatePages</label>
                  <input
                    id="f_candidatePages"
                    type="number"
                    min="1"
                    step="1"
                    placeholder="nechat prázdné = defaults"
                  />
                  <details class="help">
                    <summary>
                      <span>Co to ovlivňuje</span
                      ><span class="k">lists[].candidatePages</span>
                    </summary>
                    <div class="helpBody">
                      Přepíše <code>defaults.candidatePages</code> jen pro tento
                      list. Kolik stránek kandidátů se stáhne z Traktu.
                      <br /><br />
                      <strong>Doporučení:</strong> 1–2 pro ladění; 3–6 pro
                      “širší pool” (podle výkonu).
                    </div>
                  </details>
                </div>
                <div>
                  <label class="small">pageLimit</label>
                  <input
                    id="f_pageLimit"
                    type="number"
                    min="1"
                    step="1"
                    placeholder="nechat prázdné = defaults"
                  />
                  <details class="help">
                    <summary>
                      <span>Co to ovlivňuje</span
                      ><span class="k">lists[].pageLimit</span>
                    </summary>
                    <div class="helpBody">
                      Přepíše <code>defaults.pageLimit</code> jen pro tento
                      list. Kolik položek se bere z jedné stránky Traktu
                      (typicky 100). <br /><br />
                      <strong>Doporučení:</strong> nech 100; snižuj jen pro
                      ladění / stabilitu.
                    </div>
                  </details>
                </div>
              </div>

              <div class="row2" style="margin-top: 10px">
                <div>
                  <label class="small">finalSize</label>
                  <input
                    id="f_finalSize"
                    type="number"
                    min="1"
                    step="1"
                    placeholder="nechat prázdné = defaults"
                  />
                  <details class="help">
                    <summary>
                      <span>Co to ovlivňuje</span
                      ><span class="k">lists[].finalSize</span>
                    </summary>
                    <div class="helpBody">
                      Přepíše <code>defaults.finalSize</code> jen pro tento
                      list. Kolik položek se uloží do výstupu
                      <code>/data/lists/&lt;id&gt;.json</code>. <br /><br />
                      <strong>Doporučení:</strong> 30–80 běžně; 10–30 když chceš
                      rychlý update; 100+ jen pokud víš, že enrich dáš výkonově.
                    </div>
                  </details>
                </div>
                <div>
                  <label class="small">sleepMs</label>
                  <input
                    id="f_sleepMs"
                    type="number"
                    min="0"
                    step="10"
                    placeholder="nechat prázdné = defaults"
                  />
                  <details class="help">
                    <summary>
                      <span>Co to ovlivňuje</span
                      ><span class="k">lists[].sleepMs</span>
                    </summary>
                    <div class="helpBody">
                      Přepíše <code>defaults.sleepMs</code> jen pro tento list.
                      Pauza mezi requesty (Trakt/ČSFD/Cinemeta) – pomáhá proti
                      rate limitům. <br /><br />
                      <strong>Doporučení:</strong> 80–200 ms; když vidíš 429 /
                      throttling, zvedni.
                    </div>
                  </details>
                </div>
              </div>

              <div class="row2" style="margin-top: 10px">
                <div>
                  <label class="small">timeoutMs</label>
                  <input
                    id="f_timeoutMs"
                    type="number"
                    min="1000"
                    step="500"
                    placeholder="nechat prázdné = defaults"
                  />
                  <details class="help">
                    <summary>
                      <span>Co to ovlivňuje</span
                      ><span class="k">lists[].timeoutMs</span>
                    </summary>
                    <div class="helpBody">
                      Přepíše <code>defaults.timeoutMs</code> jen pro tento
                      list. Timeout pro HTTP requesty. <br /><br />
                      <strong>Doporučení:</strong> 8000–15000 ms běžně; 20000+
                      když máš slabší HW nebo pomalejší síť.
                    </div>
                  </details>
                </div>
                <div></div>
              </div>

              <div class="row2" style="margin-top: 10px">
                <div>
                  <label class="small">dupRules.hardBlockTop</label>
                  <input
                    id="f_hardTop"
                    type="number"
                    min="0"
                    step="1"
                    placeholder="nechat prázdné = defaults"
                  />
                  <details class="help">
                    <summary>
                      <span>Co to ovlivňuje</span
                      ><span class="k">lists[].dupRules.hardBlockTop</span>
                    </summary>
                    <div class="helpBody">
                      Přepíše <code>dupRules.hardBlockTop</code> jen pro tento
                      list. Prvních N pozic nebude obsazeno položkou, která už
                      byla použitá v jiném listu stejného typu. <br /><br />
                      <strong>Doporučení:</strong> 0–5 jemně; 8–15 když chceš
                      výrazně větší diverzitu mezi listy.
                    </div>
                  </details>
                </div>
                <div>
                  <label class="small">dupRules.penaltyPerHit</label>
                  <input
                    id="f_penalty"
                    type="number"
                    min="0"
                    step="1"
                    placeholder="nechat prázdné = defaults"
                  />
                  <details class="help">
                    <summary>
                      <span>Co to ovlivňuje</span
                      ><span class="k">lists[].dupRules.penaltyPerHit</span>
                    </summary>
                    <div class="helpBody">
                      Přepíše <code>dupRules.penaltyPerHit</code> jen pro tento
                      list. Penalizace skóre za každé předchozí použití stejné
                      položky. <br /><br />
                      <strong>Doporučení:</strong> 1–5 lehce; 8–15 když se ti
                      pořád opakují stejné top věci napříč listy.
                    </div>
                  </details>
                </div>
              </div>

              <div class="compactBottom">
                <button class="btn small" id="btnNew" type="button">
                  Nový
                </button>
                <button class="btn small" id="btnSort" type="button">
                  Seřadit podle názvu
                </button>
                <button class="btn primary" id="btnUpsert" type="button">
                  Uložit list (do UI)
                </button>
                <button class="btn danger" id="btnDelete" type="button">
                  Smazat list
                </button>
              </div>

              <div class="hr"></div>

              <div class="subHead">
                <strong>RAW JSON listu</strong>
                <span class="muted">kopie / import jednoho listu</span>
              </div>
              <textarea
                id="f_raw"
                class="mono"
                style="width: 100%; min-height: 170px; resize: vertical"
                placeholder='{"id":"my_list","name":"Můj list", ...}'
              ></textarea>
              <div
                class="row"
                style="
                  gap: 8px;
                  margin-top: 8px;
                  justify-content: flex-end;
                  flex-wrap: wrap;
                "
              >
                <button id="btnListRawFromForm" class="btn small" type="button">
                  Načíst z editoru
                </button>
                <button id="btnListRawCopy" class="btn small" type="button">
                  Kopírovat RAW
                </button>
                <button id="btnListRawApply" class="btn small primary" type="button">
                  Použít RAW do UI
                </button>
              </div>

              <details class="help" style="margin-top: 12px">
                <summary>
                  <span>Uložit list vs Uložit vše na disk</span
                  ><span class="k">workflow</span>
                </summary>
                <div class="helpBody">
                  <ul>
                    <li>
                      <strong>Uložit list (do UI)</strong> uloží změny jen do
                      paměti v prohlížeči (tabulka + editor).
                    </li>
                    <li>
                      <strong>Uložit vše na disk</strong> teprve zapíše celý
                      config do <code>/data/config</code>.
                    </li>
                  </ul>
                </div>
              </details>
            </div>
          </details>

          <!-- SMARTPICKS -->
          <details class="section sectionSmart">
            <summary>
              <div class="sectionTitle">
                <strong>SmartPicks</strong>
                <span>Profily (Ty / žena / děti) – denní mix podle filtrů</span>
              </div>
              <div class="sectionChevron">Rozbalit / sbalit</div>
            </summary>

            <div class="sectionBody">
              <details class="help">
                <summary>
                  <span>Jak SmartPicks fungují</span
                  ><span class="k">lists.smartPicks</span>
                </summary>
                <div class="helpBody">
                  SmartPicks si vytáhnou kandidáty z vybraných Trakt zdrojů
                  a/nebo existujících listů, aplikují filtry (years +
                  include/exclude genres) a vyberou denní výběr. Výstup je list
                  <code>/data/lists/&lt;profileId&gt;.json</code>.
                </div>
              </details>

              <div class="row" style="justify-content: space-between">
                <div>
                  <div style="font-weight: 800; margin-bottom: 6px">
                    SmartPicks
                  </div>
                  <div class="muted">
                    Ukládá se do <span class="mono">lists.trakt.json</span> →
                    <span class="mono">lists.smartPicks</span>.
                  </div>
                </div>

                <div class="row" style="gap: 10px">
                  <label class="chk">
                    <input id="sp_enabled" type="checkbox" />
                    <span>Zapnuto</span>
                  </label>

                  <label class="field" style="min-width: 180px">
                    <span class="lbl">Default počet</span>
                    <input
                      id="sp_defaultSize"
                      type="number"
                      min="1"
                      max="50"
                      step="1"
                      value="10"
                    />
                  </label>

                  <button id="btnSpNew" class="btn small" type="button">
                    Nový profil
                  </button>
                  <button id="btnSpSort" class="btn small" type="button">
                    Seřadit
                  </button>
                </div>
              </div>

              <details class="help" style="margin-top: 10px">
                <summary>
                  <span>Zapnuto + Default počet</span
                  ><span class="k">smartPicks.enabled / defaultSize</span>
                </summary>
                <div class="helpBody">
                  <ul>
                    <li>
                      <code>enabled</code>: když je vypnuto, SmartPicks se
                      negenerují.
                    </li>
                    <li>
                      <code>defaultSize</code>: počet položek, pokud profil nemá
                      vlastní <code>size</code>.
                    </li>
                  </ul>
                </div>
              </details>

              <div class="divider"></div>

              <div class="box">
                <div class="boxHead">
                  <strong>Profily</strong>
                  <span class="pill" id="sp_countPill">0</span>
                </div>

                <div class="tableWrap">
                  <table class="tbl">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Název</th>
                        <th>Typ</th>
                        <th>Počet</th>
                        <th>Zdroje</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody id="sp_tblBody"></tbody>
                  </table>
                </div>

                <details class="help" style="margin-top: 10px">
                  <summary>
                    <span>Co znamená “Zdroje”</span
                    ><span class="k">fromTrakt / fromTmdb / fromLists</span>
                  </summary>
                  <div class="helpBody">
                    Zdroje jsou kombinace:
                    <ul>
                      <li>
                        Trakt endpointy (<code>/movies/…</code>,
                        <code>/shows/…</code>)
                      </li>
                      <li>
                        lokální listy podle ID (už vygenerované
                        <code>/data/lists</code>)
                      </li>
                    </ul>
                  </div>
                </details>
              </div>

              <div class="divider"></div>

              <div class="box">
                <div class="boxHead">
                  <strong>Editor profilu</strong>
                  <span class="muted" id="sp_editHint"></span>
                </div>

                <div class="row2">
                  <label class="field">
                    <span class="lbl">Profil ID (např. <code>me</code>)</span>
                    <input id="sp_id" type="text" placeholder="me" />
                  </label>

                  <label class="field">
                    <span class="lbl">Název profilu</span>
                    <input id="sp_name" type="text" placeholder="Pro mě" />
                  </label>
                </div>

                <details class="help" style="margin-top: 10px">
                  <summary>
                    <span>ID + název</span
                    ><span class="k">profiles[].id / name</span>
                  </summary>
                  <div class="helpBody">
                    ID je název výstupního souboru
                    <code>/data/lists/&lt;id&gt;.json</code>. Název je jen pro
                    přehled v UI / Stremiu.
                  </div>
                </details>

                <div class="row2" style="margin-top: 10px">
                  <label class="field">
                    <span class="lbl">Typ</span>
                    <select id="sp_type">
                      <option value="movie">Filmy</option>
                      <option value="series">Seriály</option>
                    </select>
                  </label>

                  <label class="field">
                    <span class="lbl">Počet položek</span>
                    <input
                      id="sp_size"
                      type="number"
                      min="1"
                      max="50"
                      step="1"
                      value="10"
                    />
                  </label>
                </div>

                <details class="help" style="margin-top: 10px">
                  <summary>
                    <span>Typ + počet</span
                    ><span class="k">profiles[].type / size</span>
                  </summary>
                  <div class="helpBody">
                    <ul>
                      <li>
                        <code>type</code> určuje, jaké zdroje dávají smysl
                        (<code>/movies</code> vs <code>/shows</code>)
                      </li>
                      <li>
                        <code>size</code> je počet položek v denním výběru pro
                        tenhle profil
                      </li>
                    </ul>
                  </div>
                </details>

                <div style="margin-top: 12px">
                  <label class="small">Roky (od–do)</label>
                  <div class="yearGrid">
                    <div class="yearBox">
                      <div class="head">
                        <span>Od</span>
                        <input
                          id="spYearMinNum"
                          type="number"
                          style="width: 110px"
                        />
                      </div>
                      <input id="spYearMin" type="range" />
                    </div>

                    <div class="yearBox">
                      <div class="head">
                        <span>Do</span>
                        <input
                          id="spYearMaxNum"
                          type="number"
                          style="width: 110px"
                        />
                      </div>
                      <input id="spYearMax" type="range" />
                    </div>
                  </div>

                  <div class="hint">
                    Uloží se do <span class="mono">years</span> jako
                    <span class="mono">YYYY-YYYY</span>. Plný rozsah = prázdné
                    (bez filtru).
                  </div>

                  <details class="help">
                    <summary>
                      <span>Soft chování</span
                      ><span class="k">filters.years</span>
                    </summary>
                    <div class="helpBody">
                      Když kandidát nemá rok, typicky projde (aby se nevynuloval
                      pool). U SmartPicks se filtry aplikují po merge kandidátů.
                    </div>
                  </details>

                  <input id="sp_years" type="text" style="display: none" />
                </div>

                <div class="hr"></div>

                <div class="subHead">
                  <strong>Zdroje</strong>
                  <span class="muted">Trakt + TMDB + existujici listy</span>
                </div>

                <div class="muted" style="margin: 6px 0 8px">
                  <strong>Trakt zdroje:</strong>
                </div>
                <div id="sp_src_trakt" class="chipBox"></div>

                <div class="muted" style="margin: 12px 0 8px">
                  <strong>TMDB zdroje:</strong>
                </div>
                <div id="sp_src_tmdb" class="chipBox"></div>


                <details class="help" style="margin-top: 10px">
                  <summary>
                    <span>Tipy pro Trakt zdroje</span
                    ><span class="k">profiles[].fromTrakt / profiles[].fromTmdb</span>
                  </summary>
                  <div class="helpBody">
                    Pokud vybereš jen filtry (years/genres) a žádné zdroje,
                    skript obvykle použije fallback
                    <code>/movies/trending</code> +
                    <code>/movies/popular</code> (nebo shows).
                  </div>
                </details>

                <div class="row" style="gap: 8px; margin-top: 10px">
                  <input
                    id="sp_customSource"
                    type="text"
                    class="mono"
                    placeholder="vlastni /movies/... /shows/... /movie/... /tv/..."
                  />
                  <button id="btnSpAddSource" class="btn small" type="button">
                    Přidat
                  </button>
                </div>

                <details class="help" style="margin-top: 10px">
                  <summary>
                    <span>Vlastní zdroj</span
                    ><span class="k">custom Trakt/TMDB path</span>
                  </summary>
                  <div class="helpBody">
                    Sem zadej Trakt nebo TMDB path (musi zacinat <code>/</code>),
                    napr. <code>/movies/trending</code> nebo
                    <code>/trending/movie/day</code>. Udrzuj konzistenci s typem
                    profilu.
                  </div>
                </details>

                <div class="muted" style="margin: 12px 0 8px">
                  <strong>Existující listy (podle typu):</strong>
                </div>
                <div id="sp_src_lists" class="checkList"></div>

                <details class="help" style="margin-top: 10px">
                  <summary>
                    <span>Listy jako zdroj</span
                    ><span class="k">profiles[].fromLists</span>
                  </summary>
                  <div class="helpBody">
                    Pokud vybereš lokální list jako zdroj, SmartPicks vezme
                    kandidáty z jeho <code>items</code>. Tohle je dobré pro
                    “mix” nad už vyčištěnými listy.
                  </div>
                </details>

                <div class="hr"></div>

                <div class="subHead">
                  <strong>Žánry</strong>
                  <span class="muted"
                    >klikáním přepínáš: none → include → exclude</span
                  >
                </div>

                <div class="row" style="gap: 8px; margin-top: 8px">
                  <input
                    id="sp_genreSearch"
                    type="text"
                    placeholder="hledat žánr…"
                  />
                  <button id="btnSpClearGenres" class="btn small" type="button">
                    Vymazat
                  </button>
                </div>

                <div
                  id="sp_genreBox"
                  class="genreBox"
                  style="margin-top: 10px"
                ></div>

                <input id="sp_includeGenres" type="hidden" />
                <input id="sp_excludeGenres" type="hidden" />

                <details class="help" style="margin-top: 10px">
                  <summary>
                    <span>Include / Exclude (soft)</span
                    ><span class="k">includeGenres / excludeGenres</span>
                  </summary>
                  <div class="helpBody">
                    Stejné chování jako u listů:
                    <ul>
                      <li>
                        <strong>include</strong>: musí se překrývat alespoň
                        jeden žánr (pokud kandidát žánry zná)
                      </li>
                      <li>
                        <strong>exclude</strong>: nesmí obsahovat žádný zakázaný
                        žánr (pokud kandidát žánry zná)
                      </li>
                    </ul>
                    Pokud kandidát žánry nemá, filtr se aplikuje soft (nevyhodí
                    se jen kvůli chybějícím datům).
                  </div>
                </details>

                <div class="hr"></div>

                <div class="subHead">
                  <strong>RAW JSON SmartPicks profilu</strong>
                  <span class="muted">kopie / import jednoho profilu</span>
                </div>
                <textarea
                  id="sp_raw"
                  class="mono"
                  style="width: 100%; min-height: 170px; resize: vertical"
                  placeholder='{"id":"sp_me","name":"Pro mě", ...}'
                ></textarea>
                <div
                  class="row"
                  style="
                    gap: 8px;
                    margin-top: 8px;
                    justify-content: flex-end;
                    flex-wrap: wrap;
                  "
                >
                  <button id="btnSpRawFromForm" class="btn small" type="button">
                    Načíst z editoru
                  </button>
                  <button id="btnSpRawCopy" class="btn small" type="button">
                    Kopírovat RAW
                  </button>
                  <button id="btnSpRawApply" class="btn small primary" type="button">
                    Použít RAW do UI
                  </button>
                </div>

                <div class="hr"></div>

                <div class="row" style="gap: 10px; justify-content: flex-end">
                  <button id="btnSpDelete" class="btn danger" type="button">
                    Smazat profil
                  </button>
                  <button id="btnSpUpsert" class="btn primary" type="button">
                    Uložit profil
                  </button>
                </div>

                <details class="help" style="margin-top: 10px">
                  <summary>
                    <span>Uložit profil vs Uložit vše na disk</span
                    ><span class="k">workflow</span>
                  </summary>
                  <div class="helpBody">
                    <ul>
                      <li>
                        <strong>Uložit profil</strong> uloží změny jen do UI
                        (paměť v prohlížeči).
                      </li>
                      <li>
                        <strong>Uložit vše na disk</strong> je potřeba pro
                        reálný zápis do <code>/data/config</code>.
                      </li>
                    </ul>
                  </div>
                </details>
              </div>
            </div>
          </details>
        </div>
      </div>
    </div>

    <script src="/client.js"></script>
    <script>
      // Na mobilu (max 700px) nech Defaults sbalené
      if (window.matchMedia("(max-width: 700px)").matches) {
        const d = document.querySelector(".section.sectionDefaults");
        if (d) d.open = false;
      }
    </script>
  </body>
</html>
